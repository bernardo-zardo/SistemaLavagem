<ui:composition template="/templates/pagina.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core">

	<ui:define name="title">
        Cadastro de Serviço
    </ui:define>

	<ui:define name="content">
		<h:form id="form1">
			<p:growl id="mensagem" />
			<p:panel header="Cadastro de Serviço" id="painelServico"
				styleClass="painel-custom-header">
				<p:panelGrid columns="2" layout="grid">

					<p:panelGrid columns="1" layout="grid">

						<p:panelGrid columns="2" layout="grid" style="margin-left:-10px">
							<h:panelGroup>
								<p:outputLabel value="Código" for="codigo" />
								<br />
								<p:inputText id="codigo" style="width: 100px"
									value="#{servicoBean.crudObj.serIdServico}" disabled="true" />
							</h:panelGroup>
						</p:panelGrid>
						
						<p:panelGrid columns="2" layout="grid" style="margin-left:-10px">
							<h:panelGroup>
								<p:outputLabel value="Data do Serviço" for="data" />
								<br />
								<p:datePicker id="data" value="#{servicoBean.crudObj.serData}"
									showIcon="true" required="true" styleClass="datePicker" style="width: 200px"
									pattern="dd/MM/yyyy" showTime="false" showOnFocus="false" 
									requiredMessage="O campo Data é obrigatório."
									widgetVar="dataPickerWidget" />
							</h:panelGroup>
						</p:panelGrid>

						<p:divider style="width: 99%;" />

						<p:panelGrid columns="2" layout="grid" style="margin-left:-10px">
							<h:panelGroup>
							<p:outputLabel value="Tipo de Serviço" for="tipoServico" />
							<br />
							<p:selectOneMenu id="tipoServico" filter="true"
								filterMatchMode="contains" required="true"
								requiredMessage="O campo Tipo de Serviço é obrigatório."
								value="#{servicoBean.crudObj.serTipoServico}" style="width:100%">
								<f:selectItem itemLabel="Selecione um tipo" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItems value="#{servicoBean.tiposServico}" var="t"
									itemLabel="#{t.tsNome}" itemValue="#{t}" />
							</p:selectOneMenu>
							</h:panelGroup>
							
							<h:panelGroup>
								<p:outputLabel value="Responsável" for="responsavel" />
								<p:selectOneMenu id="responsavel" filter="true"
									filterMatchMode="contains" required="true"
									requiredMessage="O campo Responsável é obrigatório."
									value="#{servicoBean.crudObj.serResponsavel}"
									style="width:100%">
									<f:selectItem itemLabel="Selecione o responsável"
										itemValue="#{null}" noSelectionOption="true" />
									<f:selectItems value="#{servicoBean.responsaveis}" var="r"
										itemLabel="#{r.resNome}" itemValue="#{r}" />
								</p:selectOneMenu>
							</h:panelGroup>
						</p:panelGrid>

						<p:panelGrid columns="2" layout="grid" style="margin-left:-10px">
							<h:panelGroup>
								<p:outputLabel value="Veículo" for="veiculo" />
								<p:selectOneMenu id="veiculo" filter="true"
									filterMatchMode="contains" required="true"
									requiredMessage="O campo Veículo é obrigatório."
									value="#{servicoBean.crudObj.serVeiculo}" style="width:100%">
									<f:selectItem itemLabel="Selecione um veículo"
										itemValue="#{null}" noSelectionOption="true" />
									<f:selectItems value="#{servicoBean.veiculos}" var="v"
										itemLabel="#{v.veiModelo} - #{v.veiPlaca}" itemValue="#{v}" />
								</p:selectOneMenu>
							</h:panelGroup>
						</p:panelGrid>

						<p:divider style="width: 99%;" />

						<p:panelGrid columns="1" layout="grid" style="margin-left:-10px">
							<p:selectBooleanCheckbox value="#{servicoBean.possuiEntrega}"
								itemLabel="Incluir entrega do veículo ao cliente">
								<p:ajax process="@this" update="@this :form1:panelPreco" />
							</p:selectBooleanCheckbox>
						</p:panelGrid>

						<p:panelGrid columns="2" layout="grid" style="margin-left:-10px">
							<h:panelGroup id="panelPreco">
								<p:outputLabel value="Preço da Entrega (R$)" for="preco" />
								<p:inputNumber id="preco"
									disabled="#{not servicoBean.possuiEntrega}"
									value="#{servicoBean.crudObj.serPrecoEntrega}" required="true"
									requiredMessage="O campo Preço é obrigatório." symbol="R$ "
									decimalPlaces="2" thousandSeparator="." decimalSeparator=","
									style="width:100%" />
							</h:panelGroup>
						</p:panelGrid>

					</p:panelGrid>
				</p:panelGrid>
			</p:panel>


			<p:panel styleClass="painel-custom">
				<div align="right">
					<p:commandButton value="Salvar"
						actionListener="#{servicoBean.salvar()}" icon="pi pi-save"
						process="@form"
						update=":form1:painelServico :form1:servicosTable :form1:mensagem"
						styleClass="btn-acoes ui-button-success" />

					<p:commandButton value="Novo"
						actionListener="#{servicoBean.criaObj()}" icon="pi pi-plus"
						process="@this" update=":form1:painelServico :form1:mensagem"
						styleClass="btn-acoes ui-button-secondary" />

					<p:commandButton value="Excluir"
						actionListener="#{servicoBean.deletar()}" icon="pi pi-trash"
						process="@this"
						update=":form1:painelServico :form1:servicosTable :form1:mensagem"
						styleClass="btn-acoes ui-button-danger" />
				</div>
			</p:panel>

			<p:panel styleClass="painel-custom-header"
				header="Serviços Cadastrados">
				<p:dataTable id="servicosTable" var="servico" reflow="true"
					sortBy="#{servico.serIdServico}" sortOrder="ascending"
					value="#{servicoBean.servicos}" paginator="true" rows="10"
					paginatorPosition="bottom" style="margin-top:10px;"
					emptyMessage="Nenhum serviço encontrado" filterEvent="keyup">

					<p:column headerText="Código" width="85"
						sortBy="#{servico.serIdServico}"
						filterBy="#{servico.serIdServico}">
						<h:outputText value="#{servico.serIdServico}" />
					</p:column>

					<p:column headerText="Data" sortBy="#{servico.serData}">
						<h:outputText value="#{servico.serData}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="Tipo de Serviço"
						sortBy="#{servico.serTipoServico.tsNome}">
						<h:outputText value="#{servico.serTipoServico.tsNome}" />
					</p:column>

					<p:column headerText="Veículo"
						sortBy="#{servico.serVeiculo.veiModelo}">
						<h:outputText
							value="#{servico.serVeiculo.veiModelo} - #{servico.serVeiculo.veiPlaca}" />
					</p:column>

					<p:column headerText="Responsável"
						sortBy="#{servico.serResponsavel.resNome}">
						<h:outputText value="#{servico.serResponsavel.resNome}" />
					</p:column>

					<p:column headerText="Preço Total (R$)"
						sortBy="#{servico.serPrecoEntrega}">
						<h:outputText value="#{servico.serPrecoTotal}">
							<f:convertNumber type="currency" currencySymbol="R$ " />
						</h:outputText>
					</p:column>

					<p:column headerText="Ações" width="140">
						<p:commandButton icon="pi pi-pencil"
							actionListener="#{servicoBean.selecionarServico(servico)}"
							process="@this"
							update=":form1:painelServico :form1:servicosTable :form1:mensagem"
							styleClass="ui-button-success" style="margin-right: 5px;" />

						<p:commandButton icon="pi pi-trash" styleClass="ui-button-danger"
							actionListener="#{servicoBean.excluirServico(servico)}"
							update=":form1:servicosTable :form1:mensagem :form1:painelServico"
							process="@this">
							<p:confirm header="Atenção!"
								message="Você tem certeza que deseja excluir esse registro?"
								icon="pi pi-exclamation-triangle" />
						</p:commandButton>
					</p:column>
				</p:dataTable>

				<p:confirmDialog global="true" showEffect="fade" hideEffect="fade"
					width="350">
					<p:commandButton value="Sim" type="button"
						styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
					<p:commandButton value="Não" type="button"
						styleClass="ui-confirmdialog-no" icon="pi pi-times" />
				</p:confirmDialog>
			</p:panel>
		</h:form>

		<script type="text/javascript">
		//<![CDATA[
	    $(document).ready(function() {
	    	function aplicarMascara(widgetVar) {
	            var input = PF(widgetVar).jq.find('input');
	            
	            input.on('input', function() {
	                var val = input.val().replace(/\D/g, ''); // Remove tudo que não é número

	                if (val.length > 2 && val.length <= 4)
	                    val = val.slice(0, 2) + '/' + val.slice(2);
	                else if (val.length > 4)
	                    val = val.slice(0, 2) + '/' + val.slice(2, 4) + '/' + val.slice(4, 8);

	                input.val(val);
	            });
	        }
	
	        aplicarMascara('dataPickerWidget');
	    });
	//]]>
</script>


	</ui:define>
</ui:composition>
